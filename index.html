<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inscrição Corrida</title>
    <!-- Fontes e Ícones -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- CONFIGURAÇÕES VISUAIS PREMIUM --- */
        :root {
            --primary: #1a237e; /* Azul Escuro Forte (Deep Indigo) */
            --primary-light: #303f9f;
            --accent: #ffb300; /* Amarelo/Laranja Dourado (Acento de Velocidade) */
            --accent-glow: rgba(255, 179, 0, 0.6);
            --bg-gradient: linear-gradient(135deg, #2c3e50 0%, #000000 100%); /* Fundo Escuro e Dramático */
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-border: rgba(255, 255, 255, 0.1);
            --shadow-dark: 0 15px 35px rgba(0, 0, 0, 0.5);
            --error: #e53935;
            --success: #43a047;
            --text-light: #f4f4f4;
            --text-dark: #222;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0; padding: 0;
            color: var(--text-dark);
            display: flex; flex-direction: column; min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary);
            z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            color: white;
        }
        
        .splash-logo {
            font-size: 80px;
            text-shadow: 0 0 20px var(--accent-glow);
            animation: pulse-logo 1.5s infinite;
        }
        @keyframes pulse-logo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .splash-hidden { opacity: 0; pointer-events: none; transform: scale(1.1); }

        /* --- HEADER & HERO SECTION --- */
        .header-container { 
            width: 100%; height: 320px; position: relative; overflow: hidden; 
            border-radius: 0 0 40px 40px; 
            box-shadow: var(--shadow-dark); 
        }
        .header-image { 
            width: 100%; height: 100%; object-fit: cover; 
            filter: grayscale(10%) brightness(0.8);
            animation: panImage 30s infinite alternate; 
        }
        @keyframes panImage { from { transform: scale(1.1) translateX(0%); } to { transform: scale(1.15) translateX(-5%); } }
        .header-overlay { 
            position: absolute; top:0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8)); 
        }
        
        .logo-wrapper { 
            position: relative; margin-top: -90px; display: flex; justify-content: center; z-index: 10; 
            padding: 0 20px; 
            animation: dropIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
            animation-delay: 0.5s; opacity: 0; 
        }
        @keyframes dropIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .logo-img, .logo-placeholder { 
            width: 160px; height: 160px; border-radius: 50%; 
            border: 8px solid var(--accent); /* Logo com borda de destaque */
            background: white; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.4); 
            object-fit: cover; 
        }
        .logo-placeholder { 
            display: flex; align-items: center; justify-content: center; 
            color: var(--primary); font-size: 4rem; 
        }

        .container { 
            max-width: 600px; /* Um pouco mais largo */
            width: 100%; margin: 0 auto; padding: 10px 20px 60px; flex: 1; position: relative; z-index: 5; 
        }

        /* TIPOGRAFIA */
        h1.event-title { 
            text-align: center; color: var(--text-light); /* Cor clara para contraste com fundo escuro */
            font-family: 'Montserrat', sans-serif; font-size: 2.5rem; font-weight: 900; 
            margin: 20px 0 5px; text-transform: uppercase; letter-spacing: 2px; 
            text-shadow: 2px 2px 0px rgba(0,0,0,0.8), 0 0 10px var(--accent-glow); 
        }
        .event-location { 
            text-align: center; color: var(--text-light); font-size: 1.1rem; 
            margin-bottom: 30px; display: flex; align-items: center; justify-content: center; 
            gap: 10px; font-weight: 500; 
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .event-location i { color: var(--accent); animation: bouncePin 2s infinite; }
        @keyframes bouncePin { 0%, 100% {transform:translateY(0);} 50% {transform:translateY(-5px);} }

        /* MENSAGEM MOTIVACIONAL (COM NOVA ANIMAÇÃO) */
        .motivational-box { 
            text-align: center; margin: 0 0 30px; padding: 20px; 
            background: var(--primary-light); 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.4); 
            color: white; 
            transition: all 0.3s; 
            border-left: 5px solid var(--accent);
            animation: pulse-motivational 3s infinite ease-in-out; /* Nova Animação */
        }
        @keyframes pulse-motivational {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
            50% { transform: scale(1.01); box-shadow: 0 10px 30px rgba(255, 179, 0, 0.2); }
        }
        .motivational-box:hover { transform: translateY(-3px) scale(1.01); box-shadow: 0 12px 30px rgba(0,0,0,0.5); }
        .motivational-text { 
            font-size: 1.2rem; font-weight: 600; font-style: italic; margin: 0; 
            font-family: 'Montserrat', sans-serif; 
            line-height: 1.4;
        }
        .event-subtitle { text-align: center; color: var(--text-light); font-size: 1.1rem; margin-bottom: 20px; font-weight: 400; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        
        /* PREMIAÇÃO (Layout otimizado) */
        .prizes-box { 
            background: var(--card-bg); 
            border: 1px solid var(--card-border); 
            border-radius: 20px; 
            padding: 30px; 
            margin-bottom: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            position: relative; 
            overflow: hidden; 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        .prizes-box:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); }
        .prizes-title { 
            color: var(--primary); font-family: 'Montserrat', sans-serif; font-weight: 900; 
            margin-bottom: 20px; text-align: left; text-transform: uppercase; 
            font-size: 1.3rem; letter-spacing: 1px; 
            border-bottom: 3px solid var(--accent); 
            padding-bottom: 10px; 
            display: flex; align-items: center; gap: 10px;
        }
        .prize-item { 
            display: flex; flex-direction: row; align-items: center; justify-content: space-between; 
            padding: 12px 15px; /* Reduzindo o padding vertical */
            background: #f7f7f7; 
            margin-bottom: 8px; /* Reduzindo espaço entre itens */
            border-radius: 15px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            transition: all 0.3s; 
            border-left: 5px solid var(--primary-light);
            transform: translateX(0);
        }
        .prize-item:hover { transform: translateX(5px); background: #fff; }
        .prize-age { 
            font-weight: 800; color: white; 
            background: var(--accent); 
            padding: 6px 12px; /* Reduzindo padding da tag de título */
            border-radius: 10px; 
            font-size: 0.9rem; 
            min-width: 120px; 
            text-align: center; 
            box-shadow: 0 2px 8px var(--accent-glow); 
            text-transform: uppercase;
        }
        .prize-value { 
            color: var(--primary); 
            font-weight: 700; 
            text-align: right; 
            font-size: 1.1rem; 
        }
        .prize-obs { 
            font-size: 0.9rem; color: #555; text-align: center; margin-top: 15px; /* Reduzindo margin top */
            background: #fff8e1; 
            padding: 15px; 
            border-radius: 15px; 
            border: 1px dashed var(--accent);
        }
        
        /* FORMULÁRIO (Card de Inscrição) */
        .form-card { 
            background: var(--card-bg); 
            border: 1px solid var(--card-border); 
            border-radius: 30px; 
            padding: 35px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
            animation: boxFadeInUp 1s cubic-bezier(0.2, 0.8, 0.2, 1) both;
        }
        @keyframes boxFadeInUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .input-group { 
            position: relative; margin-bottom: 30px; 
            border-bottom: 2px solid #ccc; 
            transition: all 0.3s; 
        }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        .input-group:focus-within { 
            border-bottom-color: var(--primary); 
            box-shadow: 0 4px 0 0 var(--primary-light); 
            transform: translateY(-2px); 
        }
        .input-group.error { border-bottom-color: var(--error); animation: shake 0.4s ease-in-out; }
        .input-group.error i, .input-group.error label { color: var(--error) !important; }
        
        /* Floating Labels */
        .input-group label {
            position: absolute; top: 15px; left: 50px; 
            color: #888; font-size: 1rem; 
            transition: 0.3s; pointer-events: none;
            font-weight: 500;
            z-index: 1; /* Garantir que o label fique atrás do ícone/input */
        }
        .input-group:focus-within label, 
        .input-group input:not(:placeholder-shown) + label,
        .input-group select:not([value=""]) + label,
        .input-group input[type="date"] + label { 
            top: -10px; left: 0; 
            font-size: 0.8rem; 
            color: var(--primary); 
            font-weight: 700;
        }

        .input-group i { 
            position: absolute; left: 15px; top: 15px; 
            color: #aaa; font-size: 1.1rem; transition: 0.3s; 
            z-index: 2; /* Ícone na frente */
        }
        .input-group:focus-within i { color: var(--primary); }
        
        input, select { 
            width: 100%; padding: 10px 15px 10px 45px; 
            border: none; background: transparent; 
            font-size: 1.1rem; color: #333; outline: none; 
            font-weight: 500; 
            margin-top: 15px;
            -webkit-appearance: none;
            z-index: 3; /* Input na frente */
            position: relative;
        }
        /* CORREÇÃO DO SELECT: Mais padding para centralizar, resolvendo a sobreposição do label */
        select { 
            padding: 10px 15px 10px 45px; /* Corrigido para ser igual aos inputs */
            height: 50px; /* Garante altura mínima consistente */
            line-height: 20px; /* Alinhamento de texto interno */
            margin-top: 15px;
            cursor: pointer;
        }

        /* Botão de Submissão (High-Energy) - ADICIONANDO ANIMAÇÃO */
        .btn-submit { 
            width: 100%; padding: 20px; 
            background: linear-gradient(90deg, var(--accent), #ff6f00); 
            color: var(--primary); 
            border: none; border-radius: 50px; 
            font-size: 1.3rem; font-weight: 900; 
            font-family: 'Montserrat', sans-serif; 
            text-transform: uppercase; cursor: pointer; 
            margin-top: 25px; 
            box-shadow: 0 0 0 0 var(--accent-glow); /* Inicial */
            transition: all 0.3s; position: relative; overflow: hidden; 
            letter-spacing: 1px;
            animation: button-pulse 1.5s infinite; /* Nova animação de pulso */
        }
        /* Definição da Animação de Pulso */
        @keyframes button-pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 179, 0, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(255, 179, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 179, 0, 0); }
        }
        .btn-submit:hover { 
            transform: translateY(-5px) scale(1.01); 
            box-shadow: 0 18px 40px var(--accent-glow); 
            color: white; 
            animation: none; /* Remove pulso no hover para focar na sombra */
        }
        .btn-submit:active { transform: scale(0.98); }

        /* BOTÃO FLUTUANTE (FAB) */
        .fab-info { 
            position: fixed; bottom: 30px; right: 20px; 
            width: 60px; height: 60px; border-radius: 50%; 
            background: var(--primary); 
            color: white; border: none; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.5rem; cursor: pointer; z-index: 100; 
            transition: transform 0.3s, background 0.3s; 
        }
        .fab-info:hover { transform: scale(1.1) rotate(5deg); background: var(--primary-light); }
        
        /* LOADER E SUCESSO */
        .loading-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999;
            background: rgba(0, 0, 0, 0.85); 
            backdrop-filter: blur(8px); 
            color: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .loading-overlay.active { opacity: 1; pointer-events: all; }
        .track-container { width: 250px; height: 100px; position: relative; overflow: hidden; display: flex; align-items: flex-end; justify-content: flex-start; border-bottom: 2px solid #555; }
        .runner-animation { font-size: 80px; color: var(--accent); position: absolute; bottom: 0; left: -80px; animation: runAcrossScreen 2s linear infinite; }
        @keyframes runAcrossScreen {
            0% { left: -80px; transform: scaleX(1); }
            45% { transform: scaleX(1); }
            50% { left: 280px; transform: scaleX(1); }
            50.1% { transform: scaleX(-1); left: 280px;} 
            95% { transform: scaleX(-1); }
            100% { left: -80px; transform: scaleX(-1); } 
        }
        .loading-text { font-weight: 900; color: var(--accent); font-size: 1.5rem; margin-top: 20px; animation: pulse 1s infinite; text-transform: uppercase; letter-spacing: 2px; }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }
        
        /* SUCESSO (Destaque e Animação) */
        .success-box { 
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9); /* Fundo suave verde/sucesso */
            border: 5px solid var(--success); /* Borda de destaque */
            padding: 50px 30px; 
            border-radius: 30px; 
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 30px rgba(67, 160, 71, 0.5); /* Sombra + Brilho verde */
            position: relative; overflow: hidden;
            animation: bounceIn 0.8s ease-out; 
            color: var(--text-dark); /* Texto escuro para contraste */
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.1); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .medal-bounce { color: var(--success); animation: medal-jiggle 2s infinite ease-in-out; } /* Cor do ícone para verde */
        @keyframes medal-jiggle { 
            0%, 100% { transform: translateY(0) rotate(0deg); }
            20% { transform: translateY(-5px) rotate(2deg); }
            40% { transform: translateY(0) rotate(-2deg); }
            60% { transform: translateY(-3px) rotate(1deg); }
            80% { transform: translateY(0) rotate(-1deg); }
        }

        .success-box h2 { color: var(--primary); }
        .success-message { font-size: 1.3rem; font-weight: 500; color: #333; } /* Maior e mais escuro */
        .hidden { display: none !important; }
        
        /* ADMIN PANEL (Tabela otimizada) */
        .admin-panel { background: var(--card-bg); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .admin-header { background: linear-gradient(to right, var(--primary), var(--primary-light)); padding: 20px; display: flex; justify-content: space-between; align-items: center; color: white; }
        .admin-tabs { background: #f0f2f5; padding: 10px; display: flex; gap: 10px; overflow-x: auto; }
        .admin-tab { padding: 10px 20px; border-radius: 10px; color: #666; font-weight: 700; cursor: pointer; transition: 0.3s; border: none; background: transparent; white-space: nowrap; }
        .admin-tab.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .admin-content { padding: 25px; }
        .tab-view { display: none; }
        .tab-view.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .total-card { 
            text-align: center; padding: 30px; 
            background: linear-gradient(135deg, var(--accent), #ff9100); 
            color: white; 
            border-radius: 25px; 
            box-shadow: 0 6px 20px rgba(255, 179, 0, 0.3);
            margin-bottom: 25px;
        }
        .total-number { font-size: 4.5rem; color: var(--primary); font-weight: 900; line-height: 1; text-shadow: none; }
        .filters-container { display: flex; gap: 10px; margin-bottom: 15px; }
        .filter-group { flex: 1; }
        .filter-select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background-color: #fcfcfc; }
        
        .btn-print { background: var(--primary-light); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(48, 63, 159, 0.3); }
        .config-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 0.95rem; background: #f9f9f9; margin-bottom: 15px; }
        .config-input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(26, 35, 126, 0.1); }
        
        /* OTIMIZAÇÃO DE ESPAÇAMENTO NA ADMIN */
        .config-form label { display: block; margin-top: 5px; margin-bottom: 3px; font-weight: 600; color: #555; font-size: 0.9rem; } /* Menos margin */
        .config-section-title { margin-top: 15px !important; margin-bottom: 10px !important; font-size: 1.1rem; }

        .btn-save-config { background: var(--success); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; margin-top: 25px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3); }
        .upload-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-upload { background: var(--primary); color: white; border: none; padding: 0 15px; border-radius: 10px; cursor: pointer; }
        .premio-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; } /* Menos margin */
        .btn-remove { background: #ff5252; color: white; border: none; width: 42px; height: 42px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 30px; cursor: pointer; font-size: 0.8rem; margin-bottom: 10px; display: inline-flex; align-items: center; gap: 5px; font-weight: bold; } /* Menos margin e padding */
        
        /* OTIMIZAÇÃO DA TABELA (MELHOR VISUALIZAÇÃO EM ADMIN) */
        #admin-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        #admin-table th, #admin-table td { padding: 8px; border: 1px solid #eee; text-align: left; }
        #admin-table thead th { background-color: #f0f2f5; color: var(--primary); font-weight: 700; position: sticky; top: 0; z-index: 10; }
        #admin-table tbody tr:nth-child(even) { background-color: #f9f9f9; }
        #admin-table tbody tr:hover { background-color: #e3f2fd; cursor: pointer; }
        .table-responsive { overflow-x: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 10px; border: 1px solid #eee; }

        /* MODAIS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-box { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 30px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-height: 85vh; overflow-y: auto; position: relative; }
        .modal-overlay.active .modal-box { transform: scale(1); }
        .modal-input { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid var(--primary-light); border-radius: 12px; text-align: center; font-size: 1.2rem; letter-spacing: 3px; font-weight: bold; color: var(--primary); }
        .btn-modal { padding: 12px 25px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        .btn-confirm { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(13, 71, 161, 0.2); }
        .btn-cancel { background: #f0f0f0; color: #666; margin-right: 10px; }
        .btn-close-modal {
            position: absolute; top: 15px; right: 15px;
            background: #f0f0f0; color: #666;
            width: 35px; height: 35px; border-radius: 50%;
            border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1rem; transition: 0.2s;
        }
        .btn-close-modal:hover { background: #e0e0e0; color: #333; }

        .info-content { text-align: left; white-space: pre-line; color: #555; line-height: 1.6; max-height: 300px; overflow-y: auto; background: #f9f9f9; padding: 15px; border-radius: 12px; border: 1px solid #eee; margin-top: 10px;}

        footer { background: rgba(0,0,0,0.1); border-top: 1px solid rgba(255,255,255,0.1); padding: 30px 20px 80px; text-align: center; font-size: 0.8rem; color: #888; }
        .dev-credit { font-weight: 600; color: var(--text-light); }
        .admin-toggle { background: none; border: none; color: var(--text-light); margin-top: 10px; cursor: pointer; font-size: 1.3rem; transition: 0.3s; }
        .admin-toggle:hover { color: var(--accent); }

        /* PRINT */
        @media print {
            @page { size: landscape; margin: 1cm; }
            .header-container, .logo-wrapper, .form-card, footer, .fab-info, .motivational-box, .event-subtitle, .admin-toggle, .admin-tabs, .btn-print, #tab-config, #tab-premios, .filters-container, .admin-header button, .upload-group .btn-upload, .btn-save-config { display: none !important; }
            body, .container { background: white; margin: 0; padding: 0; width: 100%; max-width: 100%; }
            #admin-view { display: block !important; box-shadow: none; width: 100%; }
            .admin-panel { box-shadow: none; padding: 0; width: 100%; }
            .admin-header { background: white; color: black; border-bottom: 2px solid black; padding: 10px; margin-bottom: 20px; display: block; text-align: center; }
            .admin-header h2 { font-size: 18pt; text-transform: uppercase; }
            .event-title { color: black !important; text-shadow: none !important; font-size: 20pt; }
            .event-location { color: #333 !important; font-size: 14pt; }
            .total-card { border: 1px solid #000; background: none; page-break-inside: avoid; margin-bottom: 20px; padding: 5px; text-align: left; color: black; box-shadow: none; }
            .total-number { color: black; font-size: 14pt; display: inline-block; margin-left: 10px; }
            .total-card h3 { color: black; font-size: 12pt; display: inline-block; margin: 0; }
            .table-responsive { overflow: visible; box-shadow: none; }
            table { font-size: 9pt; border: 1px solid #000; width: 100%; border-collapse: collapse; table-layout: auto; }
            th { background-color: #ddd !important; color: black; border: 1px solid #000; padding: 4px; text-align: left; -webkit-print-color-adjust: exact; }
            td { border: 1px solid #000; padding: 4px; word-wrap: break-word; }
            tr[style*="display: none"] { display: none !important; }
        }
    </style>
</head>
<body>

    <!-- SPLASH SCREEN (INTRO) -->
    <div id="splash-screen">
      <div class="splash-logo"><i class="fas fa-bolt"></i></div>
      <p style="margin-top:20px; font-size:1.5rem; font-family:'Montserrat', sans-serif;">PRONTO PARA CORRER?</p>
      <p style="margin-top:5px; font-weight:300;">Carregando Experiência...</p>
    </div>

    <!-- CABEÇALHO HERO -->
    <div class="header-container">
        <!-- O JS insere a imagem de capa aqui -->
        <div style="height:100%; background:var(--primary-light); display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,0.2); font-size:5rem;"><i class="fas fa-camera"></i></div>
        <div class="header-overlay"></div>
    </div>
    <div class="logo-wrapper">
        <div class="logo-placeholder"><i class="fas fa-running"></i></div>
    </div>

    <!-- BOTÃO FLUTUANTE DE INFORMAÇÕES -->
    <button class="fab-info" onclick="abrirModalInfo()"><i class="fas fa-info"></i></button>

    <div class="container">
      <!-- FORMULÁRIO -->
      <div id="form-view">
        <h1 class="event-title">Carregando Evento...</h1>
        <!-- EXIBIÇÃO DO LOCAL -->
        <div class="event-location"><i class="fas fa-map-marker-alt"></i> <span id="display-local">...</span></div>
        
        <div class="motivational-box" style="display:none;"><p class="motivational-text"></p></div>
        <p class="event-subtitle">Preencha seus dados para garantir sua vaga na largada.</p>

        <!-- PREMIAÇÃO GERAL -->
        <div id="prizes-geral-container" class="prizes-box" style="display:none;">
          <div class="prizes-title"><i class="fas fa-trophy" style="color:var(--accent);"></i> Premiação Geral</div>
          <div id="user-prizes-list" class="prize-list"></div>
          <div id="user-prizes-obs" class="prize-obs" style="display:none;"></div>
        </div>

        <!-- PREMIAÇÃO POR CATEGORIA -->
        <div id="prizes-cat-container" class="prizes-box" style="display:none;">
          <div class="prizes-title"><i class="fas fa-medal" style="color:var(--accent);"></i> Premiação por Categoria</div>
          <div id="user-prizes-cat-list" class="prize-list"></div>
          <div id="user-prizes-cat-obs" class="prize-obs" style="display:none;"></div>
        </div>

        <form id="cadastroForm" class="form-card" onsubmit="enviarDados(event)">
          <!-- Nome Completo -->
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="nome" placeholder=" " required>
            <label for="nome">Nome Completo</label>
          </div>
          <!-- CPF -->
          <div class="input-group">
            <i class="fas fa-id-card"></i>
            <input type="text" id="cpf" placeholder=" " maxlength="14" oninput="mascaraCPF(this)" required>
            <label for="cpf">CPF (apenas números)</label>
          </div>
          <!-- Nascimento -->
          <div class="input-group">
            <i class="fas fa-calendar-alt"></i>
            <input type="text" id="nascimento" placeholder=" " onfocus="ativarData(this)" onblur="formatarDataVisual(this)" required>
            <label for="nascimento">Data de Nascimento</label>
          </div>
          <!-- Gênero (CORRIGIDO) -->
          <div class="input-group">
            <i class="fas fa-venus-mars"></i>
            <select id="genero" required value="">
              <option value="" disabled selected>Selecione o Gênero</option>
              <option value="Masculino">Masculino</option>
              <option value="Feminino">Feminino</option>
            </select>
            <label for="genero">Gênero</label>
          </div>
          <!-- Equipe (Opcional) -->
          <div class="input-group">
            <i class="fas fa-users"></i>
            <input type="text" id="equipe" placeholder=" ">
            <label for="equipe">Nome da Equipe (Opcional)</label>
          </div>
          <!-- Telefone -->
          <div class="input-group">
            <i class="fas fa-phone-alt"></i>
            <input type="text" id="telefone" placeholder=" " maxlength="15" oninput="mascaraTelefone(this)" required>
            <label for="telefone">Telefone / WhatsApp</label>
          </div>
          <!-- Endereço -->
          <div class="input-group">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="endereco" placeholder=" " required>
            <label for="endereco">Endereço Completo</label>
          </div>
          <button type="submit" class="btn-submit"><i class="fas fa-check-circle"></i> CONFIRMAR INSCRIÇÃO</button>
        </form>
      </div>

      <!-- SUCESSO ANIMADO -->
      <div id="success-view" class="hidden">
        <div class="success-box" id="success-box-content">
          <i class="fas fa-running fa-5x medal-bounce" style="color: var(--success); margin-bottom: 20px;"></i>
          <h2 style="color: var(--primary); text-transform: uppercase;">Pronto para a largada, <span id="success-name">Atleta</span>!</h2>
          <p class="success-message">Sua inscrição foi confirmada com sucesso.<br>Nos vemos na linha de chegada!</p>
          <hr style="border:0; border-top:1px solid #eee; margin:25px 0;">
          <button onclick="novaInscricao()" class="btn-submit" style="background:#eee; color:#555; box-shadow:none; font-weight:600;"><i class="fas fa-redo"></i> Nova Inscrição</button>
        </div>
      </div>

      <!-- ADMIN -->
      <div id="admin-view" class="hidden">
        <div class="admin-panel">
          <div class="admin-header"><h2><i class="fas fa-cog"></i> Administração</h2><button onclick="novaInscricao()"><i class="fas fa-sign-out-alt"></i> Sair</button></div>
          <!-- ABAS DO ADMIN -->
          <div class="admin-tabs">
            <button class="admin-tab active" onclick="mudarAba('dashboard')">Dashboard</button>
            <button class="admin-tab" onclick="mudarAba('config')">Configurações</button>
            <button class="admin-tab" onclick="mudarAba('premios')">Premiação</button>
          </div>
          
          <div class="admin-content">
            <!-- ABA DASHBOARD -->
            <div id="tab-dashboard" class="tab-view active">
              <div class="total-card"><h3>Total de Inscritos (Filtrado)</h3><div class="total-number" id="admin-total">0</div></div>
              
              <!-- FILTROS DUPLOS -->
              <div class="filters-container">
                <div class="filter-group">
                  <label>Filtrar por Categoria:</label>
                  <select id="filter-cat" class="filter-select" onchange="filtrarTabela()">
                    <option value="Todas">Todas as Categorias</option>
                    <option value="16 a 29 anos">16 a 29 anos</option>
                    <option value="30 a 39 anos">30 a 39 anos</option>
                    <option value="40 a 49 anos">40 a 49 anos</option>
                    <option value="50 a 59 anos">50 a 59 anos</option>
                    <option value="+60 anos">+60 anos</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Filtrar por Gênero:</label>
                  <select id="filter-gen" class="filter-select" onchange="filtrarTabela()">
                    <option value="Todos">Todos</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Feminino">Feminino</option>
                  </select>
                </div>
              </div>

              <button onclick="window.print()" class="btn-print"><i class="fas fa-file-pdf"></i> Imprimir Relatório (PDF)</button>
              <div class="table-responsive" style="overflow-x: auto;"><table id="admin-table"><thead><tr><th>Data</th><th>Nome</th><th>CPF</th><th>Nasc.</th><th>Tel</th><th>Gênero</th><th>Equipe</th><th>Idade</th><th>Cat.</th><th>Endereço</th></tr></thead><tbody></tbody></table></div>
            </div>
            
            <!-- ABA CONFIGURAÇÕES -->
            <div id="tab-config" class="tab-view">
              <div class="config-form">
                <div class="config-section-title" style="font-weight:700; color:var(--primary);">Geral</div>
                <label>Nome do Evento</label><input type="text" id="cfg-nome" class="config-input">
                <label>Local do Evento</label><input type="text" id="cfg-local" class="config-input">
                <label>Imagem de Capa (URL)</label>
                <div class="upload-group"><input type="text" id="cfg-capa" class="config-input"><button type="button" class="btn-upload" onclick="document.getElementById('file-capa').click()"><i class="fas fa-cloud-upload-alt"></i></button><input type="file" id="file-capa" hidden accept="image/*" onchange="uploadImgBB(this, 'cfg-capa')"></div>
                <label>Imagem do Logo (URL)</label>
                <div class="upload-group"><input type="text" id="cfg-logo" class="config-input"><button type="button" class="btn-upload" onclick="document.getElementById('file-logo').click()"><i class="fas fa-cloud-upload-alt"></i></button><input type="file" id="file-logo" hidden accept="image/*" onchange="uploadImgBB(this, 'cfg-logo')"></div>
                <label>Frase Motivacional</label><input type="text" id="cfg-frase" class="config-input">
                <label>Senha do Administrador</label><input type="text" id="cfg-senha" class="config-input">
                <div class="config-section-title" style="margin-top:20px; font-weight:700; color:var(--primary);">Informações do Evento</div>
                <label>Regras e Detalhes</label><textarea id="cfg-regras" class="config-input" style="height:150px;"></textarea>
                <button onclick="salvarConfig()" class="btn-save-config"><i class="fas fa-save"></i> Salvar Alterações</button>
              </div>
            </div>

            <!-- ABA PREMIAÇÃO DINÂMICA -->
            <div id="tab-premios" class="tab-view">
              <div class="config-form">
                <div class="config-section-title" style="font-weight:700; color:var(--primary);">Premiação Geral</div>
                <button type="button" class="btn-add" onclick="addPremioRow('admin-premios-list')"><i class="fas fa-plus"></i> Adicionar Prêmio</button>
                <div id="admin-premios-list"></div>
                <label style="margin-top:10px;">Observação (Geral)</label>
                <textarea id="cfg-obs-premio" class="config-input" style="height:60px;"></textarea>

                <div class="config-section-title" style="margin-top:30px; font-weight:700; color:var(--primary);">Premiação por Categoria</div>
                <button type="button" class="btn-add" onclick="addPremioRow('admin-premios-cat-list')"><i class="fas fa-plus"></i> Adicionar Prêmio</button>
                <div id="admin-premios-cat-list"></div>
                <label style="margin-top:10px;">Observação (Categoria)</label>
                <textarea id="cfg-obs-premio-cat" class="config-input" style="height:60px;"></textarea>

                <button onclick="salvarConfig()" class="btn-save-config" style="margin-top:20px;"><i class="fas fa-save"></i> Salvar Prêmios</button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- MODAIS (Inalterados, apenas estilizados) -->
    <div id="modal-senha" class="modal-overlay">
      <div class="modal-box">
        <button class="btn-close-modal" onclick="fecharModalAdmin()"><i class="fas fa-times"></i></button>
        <i class="fas fa-lock fa-2x" style="color:var(--primary); margin-bottom:10px;"></i>
        <h3>Área Restrita</h3>
        <input type="password" id="input-senha-modal" class="modal-input" placeholder="••••••">
        <p id="erro-senha" style="color:var(--error); font-size:0.8rem; display:none;">Senha incorreta!</p>
        <div class="modal-actions"><button class="btn-modal btn-confirm" onclick="confirmarLoginAdmin()">Entrar</button></div>
      </div>
    </div>

    <div id="modal-info" class="modal-overlay">
      <div class="modal-box">
        <button class="btn-close-modal" onclick="fecharModalInfo()"><i class="fas fa-times"></i></button>
        <i class="fas fa-info-circle fa-2x" style="color:var(--accent); margin-bottom:10px;"></i>
        <h3>Informações do Evento</h3>
        <div id="info-texto" class="info-content"></div>
      </div>
    </div>

    <div id="modal-aviso" class="modal-overlay">
      <div class="modal-box">
        <i id="aviso-icon" class="fas fa-exclamation-circle fa-2x" style="margin-bottom:10px;"></i>
        <h3 id="aviso-titulo">Aviso</h3>
        <p id="aviso-texto" style="color:#666; margin-bottom:20px;"></p>
        <div class="modal-actions"><button class="btn-modal btn-confirm" onclick="fecharModalAviso()">OK</button></div>
      </div>
    </div>

    <!-- LOADING OVERLAY ANIMADO -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="track-container">
        <div class="runner-animation"><i class="fas fa-running"></i></div>
      </div>
      <div class="loading-text">Processando...</div>
    </div>

    <footer><p>Desenvolvido por <span class="dev-credit">Thiego Pereira</span></p><button class="admin-toggle" onclick="abrirModalAdmin()"><i class="fas fa-lock"></i></button></footer>

    <script>
      // --- CONFIGURAÇÃO ---
      // ATENÇÃO: Mantenha sua URL de API original aqui!
      const API_URL = "https://script.google.com/macros/s/AKfycbwAQk2VM3oGr5ZhHge7ZIPy7hzQz-TqFO3u8QeAzjTEaCNURDvJW39Cyk-0MEXwzHRw/exec";
      const IMGBB_API_KEY = "fa0265b3bfc740c1eb09a7e4d6ec493a";

      // --- INICIALIZAÇÃO E FUNÇÕES DE UI (INALTERADAS) ---
      
      document.addEventListener('DOMContentLoaded', () => {
        fetch(`${API_URL}?action=ping`).catch(() => {});
        carregarConfigsIniciais();
      });

      function carregarConfigsIniciais() {
        document.querySelector('.loading-text').innerText = "A carregar evento...";
        
        fetch(`${API_URL}?action=getConfig`)
          .then(res => res.json())
          .then(data => {
            if(data.status === 'success') {
              atualizarInterface(data.data);
            }
            // Remove splash screen suavemente
            const splash = document.getElementById('splash-screen');
            splash.classList.add('splash-hidden');
            setTimeout(() => splash.style.display = 'none', 800);
          })
          .catch(err => {
            console.error(err);
            document.getElementById('splash-screen').style.display = 'none'; // Fecha mesmo com erro para não travar
          });
      }

      function atualizarInterface(cfg) {
        const headerContainer = document.querySelector('.header-container');
        if(cfg.URL_CAPA) headerContainer.innerHTML = `<img src="${cfg.URL_CAPA}" class="header-image" onerror="this.onerror=null; this.src='https://placehold.co/1200x600/1a237e/ffb300?text=CAPA+DO+EVENTO';" alt="Capa do Evento"><div class="header-overlay"></div>`;
        
        const logoWrapper = document.querySelector('.logo-wrapper');
        if(cfg.URL_LOGO) logoWrapper.innerHTML = `<img src="${cfg.URL_LOGO}" class="logo-img" onerror="this.onerror=null; this.src='https://placehold.co/160x160/1a237e/ffb300?text=LOGO';" alt="Logo do Evento">`;
        
        document.querySelector('h1.event-title').innerText = cfg.NOME_EVENTO;
        document.getElementById('display-local').innerText = cfg.LOCAL_EVENTO || "";
        
        const motBox = document.querySelector('.motivational-box');
        if (cfg.FRASE_MOTIVACIONAL) {
            motBox.style.display = 'block';
            motBox.querySelector('.motivational-text').innerHTML = `<i class="fas fa-quote-left" style="font-size:0.8em; margin-right:5px;"></i> ${cfg.FRASE_MOTIVACIONAL} <i class="fas fa-quote-right" style="font-size:0.8em; margin-left:5px;"></i>`;
        } else { motBox.style.display = 'none'; }

        // Renderiza Prémios
        renderizarListaPremios(cfg.LISTA_PREMIOS, 'user-prizes-list', 'prizes-geral-container');
        const obsDiv = document.getElementById('user-prizes-obs');
        if(cfg.OBS_PREMIACAO) { obsDiv.style.display = 'block'; obsDiv.innerText = cfg.OBS_PREMIACAO; } else { obsDiv.style.display = 'none'; }

        renderizarListaPremios(cfg.LISTA_PREMIOS_CAT, 'user-prizes-cat-list', 'prizes-cat-container');
        const obsCatDiv = document.getElementById('user-prizes-cat-obs');
        if(cfg.OBS_PREMIACAO_CAT) { obsCatDiv.style.display = 'block'; obsCatDiv.innerText = cfg.OBS_PREMIACAO_CAT; } else { obsCatDiv.style.display = 'none'; }

        document.getElementById('info-texto').innerText = cfg.REGRAS_EVENTO || "Sem informações adicionais.";
      }

      function renderizarListaPremios(jsonString, listId, containerId) {
        const listEl = document.getElementById(listId);
        const containerEl = document.getElementById(containerId);
        listEl.innerHTML = "";
        let lista = [];
        try { lista = JSON.parse(jsonString); } catch(e) {}
        
        if (lista && lista.length > 0) {
          containerEl.style.display = 'block';
          lista.forEach(p => {
            listEl.innerHTML += `<div class="prize-item"><span class="prize-age">${p.titulo}</span> <span class="prize-value">${p.valor}</span></div>`;
          });
        } else {
          containerEl.style.display = 'none';
        }
      }

      /* API IMGBB */
      function uploadImgBB(input, targetId) {
        if (!IMGBB_API_KEY || IMGBB_API_KEY === "SEU_IMGBB_KEY") {
             mostrarAviso("Atenção", "Por favor, defina a chave IMGBB_API_KEY no script para usar o upload de imagens.", true);
             return;
        }
        if (input.files && input.files[0]) {
          const formData = new FormData(); formData.append("image", input.files[0]); formData.append("key", IMGBB_API_KEY);
          document.getElementById('loading-overlay').classList.add('active'); document.querySelector('.loading-text').innerText = "A enviar imagem...";
          fetch("https://api.imgbb.com/1/upload", { method: "POST", body: formData }).then(res => res.json()).then(data => {
              document.getElementById('loading-overlay').classList.remove('active');
              if (data.success) { document.getElementById(targetId).value = data.data.url; mostrarAviso("Sucesso", "Imagem carregada!", false); } else { mostrarAviso("Erro", "Falha ao enviar imagem.", true); }
          }).catch(() => { document.getElementById('loading-overlay').classList.remove('active'); mostrarAviso("Erro", "Erro de conexão ImgBB.", true); });
        }
      }

      /* MASCARAS */
      function mascaraCPF(i) { var v = i.value; if(isNaN(v[v.length-1])){ i.value = v.substring(0, v.length-1); return; } v = v.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"); i.value = v; }
      function mascaraTelefone(i) { var v = i.value; v = v.replace(/\D/g,"").replace(/^(\d{2})(\d)/g,"($1) $2").replace(/(\d)(\d{4})$/,"$1-$2"); i.value = v; }
      
      // Função para ativar o input de data (e mover o label)
      function ativarData(input) { 
        // Move o label antes de mudar o tipo
        const label = input.nextElementSibling;
        if(label) { 
             label.style.top = '-10px'; label.style.left = '0'; label.style.fontSize = '0.8rem'; label.style.color = 'var(--primary)'; label.style.fontWeight = '700'; 
             input.setAttribute('data-label-moved', 'true'); // Marca que o label foi movido pelo foco
        }

        if (input.value && input.value.includes('/')) { const p = input.value.split('/'); input.value = `${p[2]}-${p[1]}-${p[0]}`; } 
        input.type = 'date'; 
        if(input.showPicker) try{input.showPicker()}catch(e){}; 
      }
      
      // Função para formatar a data (e recolocar o label se necessário)
      function formatarDataVisual(input) { 
        const v = input.value; 
        const label = input.nextElementSibling;

        if (v && v.includes('-')) { 
            const p = v.split('-'); input.type = 'text'; input.value = `${p[2]}/${p[1]}/${p[0]}`; 
            // Se tem valor, mantém o label na posição 'up'
            if(label) input.setAttribute('data-label-moved', 'true');
        } else if (!v) {
            input.type = 'text';
            // Se está vazio, reposiciona o label para a posição inicial
            if(label) { 
                label.style.top = '15px'; label.style.left = '50px'; label.style.fontSize = '1rem'; label.style.color = '#888'; label.style.fontWeight = '500'; 
                input.setAttribute('data-label-moved', 'false');
            }
        }
      }

      /* AVISO */
      function mostrarAviso(titulo, texto, isErro = false) {
        document.getElementById('aviso-titulo').innerText = titulo; document.getElementById('aviso-texto').innerText = texto;
        const icon = document.getElementById('aviso-icon'); if(isErro) { icon.className = "fas fa-times-circle fa-2x"; icon.style.color = "var(--error)"; } else { icon.className = "fas fa-check-circle fa-2x"; icon.style.color = "var(--success)"; }
        document.getElementById('modal-aviso').classList.add('active');
      }
      function fecharModalAviso() { document.getElementById('modal-aviso').classList.remove('active'); }

      /* LOGICA ENVIO (POST) */
      function enviarDados(e) {
        e.preventDefault(); 
        let valido = true; const requireds = document.querySelectorAll('#cadastroForm [required]');
        
        // Remove classes de erro antes de revalidar
        document.querySelectorAll('.input-group.error').forEach(g => g.classList.remove('error'));

        requireds.forEach(el => { 
            const group = el.closest('.input-group'); 
            // Tratamento especial para SELECT com o valor padrão "disabled selected"
            const isSelectDefault = el.tagName === 'SELECT' && el.value === "";

            if(!el.value || isSelectDefault || (el.id === 'cpf' && el.value.length < 14)) { 
                group.classList.add('error'); valido = false; 
            } else { 
                group.classList.remove('error'); 
            } 
        });

        if(!valido) { 
            document.querySelector('.error').scrollIntoView({behavior: 'smooth', block: 'center'}); 
            return; 
        }

        document.getElementById('loading-overlay').classList.add('active');
        document.querySelector('.loading-text').innerText = "Salvando cadastro...";
        
        const nomeCompleto = document.getElementById('nome').value; const primeiroNome = nomeCompleto.split(' ')[0];
        const dados = { action: 'salvarCadastro', payload: { nome: nomeCompleto, cpf: document.getElementById('cpf').value, nascimento: document.getElementById('nascimento').value, telefone: document.getElementById('telefone').value, endereco: document.getElementById('endereco').value, genero: document.getElementById('genero').value, equipe: document.getElementById('equipe').value } };
        
        fetch(API_URL, { method: 'POST', body: JSON.stringify(dados) })
          .then(res => res.json())
          .then(res => { 
            document.getElementById('loading-overlay').classList.remove('active'); 
            if (res.success) { 
              document.getElementById('success-name').innerText = primeiroNome;
              document.getElementById('form-view').classList.add('hidden'); 
              document.getElementById('success-view').classList.remove('hidden'); 
              window.scrollTo(0,0);
              
              // Efeito confete
              for(let i=0; i<30; i++) {
                let confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
                confetti.style.backgroundColor = ['#f00', '#0f0', '#00f', '#ff0', '#0ff'][Math.floor(Math.random()*5)];
                document.getElementById('success-box-content').appendChild(confetti);
              }

            } else { mostrarAviso("Atenção", res.message, true); }
          })
          .catch(err => { document.getElementById('loading-overlay').classList.remove('active'); mostrarAviso("Erro", "Falha ao enviar. Tente novamente.", true); });
      }
      function novaInscricao() { 
        document.getElementById('cadastroForm').reset(); 
        document.getElementById('nascimento').type = 'text'; 
        
        // Remove estilos de foco dos labels
        document.querySelectorAll('.input-group label').forEach(label => {
             label.style.top = '15px'; label.style.left = '50px'; label.style.fontSize = '1rem'; label.style.color = '#888'; label.style.fontWeight = '500'; 
        });

        document.querySelectorAll('.confetti').forEach(el => el.remove());
        document.getElementById('success-view').classList.add('hidden'); 
        document.getElementById('admin-view').classList.add('hidden'); 
        document.getElementById('form-view').classList.remove('hidden'); 
        window.scrollTo(0,0); 
      }

      /* MODAIS */
      function abrirModalInfo() { document.getElementById('modal-info').classList.add('active'); }
      function fecharModalInfo() { document.getElementById('modal-info').classList.remove('active'); }
      function abrirModalAdmin() { document.getElementById('modal-senha').classList.add('active'); document.getElementById('input-senha-modal').value = ''; document.getElementById('erro-senha').style.display = 'none'; document.getElementById('input-senha-modal').focus(); }
      function fecharModalAdmin() { document.getElementById('modal-senha').classList.remove('active'); }

      function confirmarLoginAdmin() {
        const senha = document.getElementById('input-senha-modal').value; const btn = document.querySelector('#modal-senha .btn-confirm'); const txt = btn.innerText; btn.innerText = "Verificando...";
        fetch(`${API_URL}?action=adminLogin&senha=${encodeURIComponent(senha)}`).then(res => res.json()).then(res => { btn.innerText = txt; if (res.success) { fecharModalAdmin(); carregarAdmin(res); } else { document.getElementById('erro-senha').innerText = res.message || "Senha incorreta!"; document.getElementById('erro-senha').style.display = 'block'; } }).catch(() => { btn.innerText = txt; mostrarAviso("Erro", "Falha de conexão.", true); });
      }
      document.getElementById('input-senha-modal').addEventListener('keyup', e => { if(e.key==='Enter') confirmarLoginAdmin() });

      /* ADMINISTRAÇÃO */
      let dadosAdminCache = [];
      function carregarAdmin(dados) {
        document.getElementById('form-view').classList.add('hidden'); document.getElementById('success-view').classList.add('hidden'); document.getElementById('admin-view').classList.remove('hidden');
        dadosAdminCache = dados.registros; filtrarTabela();
        const cfg = dados.configsAtuais;
        document.getElementById('cfg-nome').value = cfg.NOME_EVENTO || ""; document.getElementById('cfg-local').value = cfg.LOCAL_EVENTO || ""; document.getElementById('cfg-capa').value = cfg.URL_CAPA || ""; document.getElementById('cfg-logo').value = cfg.URL_LOGO || ""; document.getElementById('cfg-frase').value = cfg.FRASE_MOTIVACIONAL || ""; document.getElementById('cfg-senha').value = cfg.SENHA_ADMIN || "";
        document.getElementById('cfg-regras').value = cfg.REGRAS_EVENTO || "";
        
        loadAdminPremios(cfg.LISTA_PREMIOS, 'admin-premios-list');
        document.getElementById('cfg-obs-premio').value = cfg.OBS_PREMIACAO || "";
        loadAdminPremios(cfg.LISTA_PREMIOS_CAT, 'admin-premios-cat-list');
        document.getElementById('cfg-obs-premio-cat').value = cfg.OBS_PREMIACAO_CAT || "";
      }

      function loadAdminPremios(json, containerId) {
        const container = document.getElementById(containerId); container.innerHTML = "";
        let lista = []; try { lista = JSON.parse(json); } catch(e){}
        if(lista.length > 0) lista.forEach(p => addPremioRow(containerId, p.titulo, p.valor));
        else addPremioRow(containerId);
      }

      function addPremioRow(containerId, titulo = "", valor = "") {
        const div = document.createElement('div'); div.className = 'premio-row';
        div.innerHTML = `<input type="text" class="config-input p-titulo" placeholder="Título" value="${titulo}"><input type="text" class="config-input p-valor" placeholder="Prêmio" value="${valor}"><button type="button" class="btn-remove" onclick="this.parentElement.remove()"><i class="fas fa-trash"></i></button>`;
        document.getElementById(containerId).appendChild(div);
      }

      function filtrarTabela() {
        const filtroCat = document.getElementById('filter-cat').value; const filtroGen = document.getElementById('filter-gen').value;
        const tbody = document.querySelector('#admin-table tbody'); tbody.innerHTML = ""; let count = 0;
        dadosAdminCache.forEach(linha => {
          const cat = linha[8]; const gen = linha[5];
          if ((filtroCat === "Todas" || cat === filtroCat) && (filtroGen === "Todos" || gen === filtroGen)) { count++; tbody.innerHTML += `<tr><td>${linha[0]}</td><td>${linha[1]}</td><td>${linha[2]}</td><td>${linha[3]}</td><td>${linha[4]}</td><td>${linha[5]}</td><td>${linha[6]}</td><td>${linha[7]}</td><td><strong>${linha[8]}</strong></td><td>${linha[9]}</td></tr>`; }
        });
        document.getElementById('admin-total').innerText = count;
      }

      function mudarAba(aba) {
        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.tab-view').forEach(v => v.classList.remove('active'));
        // Mapeamento de botões e vistas
        const tabs = ['dashboard', 'config', 'premios'];
        const index = tabs.indexOf(aba);
        
        if (index > -1) {
            document.querySelectorAll('.admin-tab')[index].classList.add('active');
            document.getElementById(`tab-${aba}`).classList.add('active');
        }
      }

      function salvarConfig() {
        document.getElementById('loading-overlay').classList.add('active'); document.querySelector('.loading-text').innerText = "Salvando...";
        
        const getPremios = (id) => {
          const lista = []; document.querySelectorAll(`#${id} .premio-row`).forEach(row => { const t = row.querySelector('.p-titulo').value; const v = row.querySelector('.p-valor').value; if(t) lista.push({titulo: t, valor: v}); }); return JSON.stringify(lista);
        };

        const novasCfgs = { 
          NOME_EVENTO: document.getElementById('cfg-nome').value, LOCAL_EVENTO: document.getElementById('cfg-local').value, URL_CAPA: document.getElementById('cfg-capa').value, URL_LOGO: document.getElementById('cfg-logo').value, FRASE_MOTIVACIONAL: document.getElementById('cfg-frase').value, SENHA_ADMIN: document.getElementById('cfg-senha').value, REGRAS_EVENTO: document.getElementById('cfg-regras').value,
          LISTA_PREMIOS: getPremios('admin-premios-list'), OBS_PREMIACAO: document.getElementById('cfg-obs-premio').value,
          LISTA_PREMIOS_CAT: getPremios('admin-premios-cat-list'), OBS_PREMIACAO_CAT: document.getElementById('cfg-obs-premio-cat').value
        };
        const dados = { action: 'salvarConfig', payload: novasCfgs };
        
        fetch(API_URL, { method: 'POST', body: JSON.stringify(dados) }).then(res => res.json()).then(res => {
              document.getElementById('loading-overlay').classList.remove('active'); 
              if(res.success) { atualizarInterface(novasCfgs); mostrarAviso("Sucesso", "Configurações salvas!", false); } else { mostrarAviso("Erro", res.message, true); } 
        }).catch(() => { document.getElementById('loading-overlay').classList.remove('active'); mostrarAviso("Erro", "Erro ao salvar.", true); });
      }
    </script>
</body>
</html>
